# devops-netology

## 3.2. Работа в терминале, лекция 2 - Михаил Караханов

**1. Какого типа команда `cd`? Попробуйте объяснить, почему она именно такого типа; опишите ход своих мыслей, если считаете что она могла бы быть другого типа.**
- Ответ: команда `cd` является встроенной командой оболочки (shell builtin). Встроенная команда является частью самой оболочки и, соответственно, при запуске не порождает новый процесс в системе. Если бы это была внешняя программа, то при запуске она порождала бы новый процесс со своим персональным PID.
  
**2. Какая альтернатива без pipe команде `grep <some_string> <some_file> | wc -l`? `man grep` поможет в ответе на этот вопрос. Ознакомьтесь с [документом](http://www.smallo.ruhr.de/award.html) о других подобных некорректных вариантах использования pipe.**
- Ответ: можно выполнить подсчет количества найденных строк без использования pipe командой типа `grep -c <some_string> <some_file>`.
  
**3. Какой процесс с PID `1` является родителем для всех процессов в вашей виртуальной машине Ubuntu 20.04?**
- Ответ: Это процесс `systemd`. Для просмотра всех процессов в системе в виде графического дерева воспользовался командой `pstree -p`.
  
**4. Как будет выглядеть команда, которая перенаправит вывод stderr `ls` на другую сессию терминала?**
- Ответ: если текущий терминал (псевдотерминал в графическом режиме) работает с сессией `/dev/pts/0` и есть еще одна активная сессия `/dev/pts/1`, то поток stderr команды ls можно перенаправить в другую сессию командой `ls <some_fake_directory> 2>/dev/pts/1`.
  
**5. Получится ли одновременно передать команде файл на stdin и вывести ее stdout в другой файл? Приведите работающий пример.**
- Ответ: например, подсчитать кол-во строк в файле file_1.txt и вывести результат в файл file_2.txt - `wc -l < file_1.txt > file_2.txt`.

**6. Получится ли находясь в графическом режиме, вывести данные из PTY в какой-либо из эмуляторов TTY? Сможете ли вы наблюдать выводимые данные?**
- Ответ: можно переключиться из графического режима в эмулятор терминала комбинацией `Ctrl + Alt + F1`, например, выполнить вход в систему и следом команду `tty`, чтобы узнать номер устройства /dev/tty (допустим, вывод команды будет /dev/tty1). Далее можно снова вернуться в графическую сессию комбинацией `Ctrl + Alt + F7` и выполнить команду, например, `ls -lh >/dev/tty1`. Для того, чтобы увидеть вывод, нужно снова переключиться в эмулятор терминала.

**7. Выполните команду `bash 5>&1`. К чему она приведет? Что будет, если вы выполните `echo netology > /proc/$$/fd/5`? Почему так происходит?**
- Ответ: команда `bash 5>&1` создает файловый дескриптор с номером `5` и перенаправляет его вывод в STDOUT для данного процесса bash. Команда `echo netology > /proc/$$/fd/5`, соответственно отправит строку `netology` на стандартный вывод.
  
**8. Получится ли в качестве входного потока для pipe использовать только stderr команды, не потеряв при этом отображение stdout на pty? Напоминаем: по умолчанию через pipe передается только stdout команды слева от `|` на stdin команды справа. Это можно сделать, поменяв стандартные потоки местами через промежуточный новый дескриптор, который вы научились создавать в предыдущем вопросе.**
- Ответ: получилось следующим образом. Создал новый дескриптор и подключил его к STDERR командой `bash 5>&2`. Далее, командой `ls -lh test_folder fake_folder 1>&5 2>| test_folder/somefile.txt` отправил стандартный вывод в pty, а STDERR через pipe в файл. Результат:
```bash
vagrant@vagrant:~$ mkdir test_folder
vagrant@vagrant:~$ 
vagrant@vagrant:~$ ls -lh test_folder fake_folder 1>&5 2>| test_folder/somefile.txt
test_folder:
total 4.0K
-rw-rw-r-- 1 vagrant vagrant 59 Nov 16 20:18 somefile.txt
vagrant@vagrant:~$ 
vagrant@vagrant:~$ cat test_folder/somefile.txt 
ls: cannot access 'fake_folder': No such file or directory
vagrant@vagrant:~$ 
```

**9. Что выведет команда `cat /proc/$$/environ`? Как еще можно получить аналогичный по содержанию вывод?**
- Ответ: команда выведет список и значения переменных окружения текущей сессии bash. Аналогчный вывод можно получить с помощью команды `env`.
  
**10. Используя `man`, опишите что доступно по адресам `/proc/<PID>/cmdline`, `/proc/<PID>/exe`.**
- Ответ: файл `/proc/<PID>/cmdline` содержит команду (полный путь с аргументами), которая запустила процесс с идентификатором `<PID>`. Файл `/proc/<PID>/exe` - это символическая ссылка на исполняемый файл, запустивший указанный процесс.
  
**11. Узнайте, какую наиболее старшую версию набора инструкций SSE поддерживает ваш процессор с помощью `/proc/cpuinfo`.**
- Ответ: `sse4_2`. Результат получен командой `grep -i SSE /proc/cpuinfo`.
  
**12. При открытии нового окна терминала и `vagrant ssh` создается новая сессия и выделяется pty. Это можно подтвердить командой `tty`, которая упоминалась в лекции 3.2. Однако:**

```bash
vagrant@netology1:~$ ssh localhost 'tty'
not a tty
```

**Почитайте, почему так происходит, и как изменить поведение.**
- Ответ: при таком подключении по SSH (с указанием выполняемой команды), необходимо дополнительно указать флаг `-t` для принудительного выделения псевдо-терминала PTY (для данной сессии SSH) с целью выполнения указанной команды. По умолчанию, без указания флага `-t`, команда будет пытаться выполниться в оболочке Login. Верный вариант команды - `ssh -t localhost 'tty'`.