# Домашнее задание к занятию "6.1. Типы и структура СУБД" - Михаил Караханов

## Задача 1

>Архитектор ПО решил проконсультироваться у вас, какой тип БД лучше выбрать для хранения определенных данных.
>
>Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:
>
>- Электронные чеки в json виде
>- Склады и автомобильные дороги для логистической компании
>- Генеалогические деревья
>- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
>- Отношения клиент-покупка для интернет-магазина
>
>Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

**Ответ:**

- ***Электронные чеки в json виде*** - для хранения данной информации, как мне кажется, лучше подойдет документо-ориентированная БД `MongoDB`. Данная БД умеет хранить документы в формате JSON произвольной структуры
- ***Склады и автомобильные дороги для логистической компании*** - для хранения этой информации подойдет графовая БД, например `Neo4j`. Склады можно представить как узлы (вершины графов), а автомобильные дороги как ребра, соединяющие узлы. При такой организации можно выполнять поиск кратчайшего пути до узла (склада) назначения
- ***Генеалогические деревья*** - в этом случае, как мне кажется, можно использовать как иерархические БД, так и реляционные БД, т.к. генеалогическое древо имеет структуру "родитель-потомок"
- ***Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутентификации*** - для информации такого типа подойдет использование БД типа Ключ-Значение. Информация в таких БД, в основном, хранится в оперативной памяти и для нее можно задавать "время жизни" (TTL)
- ***Отношения клиент-покупка для интернет-магазина*** - для чувствительной финансовой информации лучше всего подходят табличные реляционные БД. В таких базах данных большое внимание уделяется ACID свойствам для обеспечения надежности и точности данных

## Задача 2

>Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если (каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):
>
>- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
>- При сетевых сбоях, система может разделиться на 2 раздельных кластера
>- Система может не прислать корректный ответ или сбросить соединение
>
>А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

**Ответ (исправленная версия после доработки):**

Ознакомился с предложенными материалами по ссылкам:

- <https://dev.to/mhihasan/cap-theorem-with-examples-hg4>
- <https://robertgreiner.com/cap-theorem-revisited/>

На основании описания CAP-теоремы и различных состояний системы из материалов, указанных выше, попробую дать классификацию указанных в задании систем.

Классификация по CAP/PACELC теоремам:

- *Данные записываются на все узлы с задержкой до часа (асинхронная запись)* - в этой распределенной системе каждый узел, скорее всего, при запросе будет возвращать последнию версию имеющихся у него данных, хотя эти данные уже могут быть устаревшими, т.к. синхронизация между узлами происходит с задержкой. Следовательно, данная система жертвует Consistency в пользу Availability. В случае сетевого разделения (потери связности между узлами), система будет стремиться к обеспечению доступности (Availability). В нормальном режиме работы, без потери связности между узлами, система, скорее всего, будет стремиться к уменьшению времени ответа на запросы (Latency). Итого:
  - CAP теорема: **AP система**
  - PACELC теорема: **PA/EL система**
- *При сетевых сбоях, система может разделиться на 2 раздельных кластера* - из заданного условия можно предположить, что узлы системы будут продолжать корректно отвечать на запросы в случае наличия проблем в связности. Синхронизация, скорее всего, произойдет после восстановления связности между всеми узлами системы. Из этого можно сделать вывод, что отдается приоритет Availability в ущерб Consistency, т.к. во время сетевого сбоя информация в двух кластерах будет различной, но узлы продолжат принимать запросы на read/write. В нормальном режиме работы, без сетевых сбоев, данная система, скорее всего, будет стремиться к обеспечению минимальной задержки в ответах (Latency). Итого:
  - CAP теорема: **AP система**
  - PACELC теорема: **PA/EL система**
- *Система может не прислать корректный ответ или сбросить соединение* - данное условие может говорить о том, что распределенная система стремится поддерживать актуальность данных на всех узлах сразу после их изменения на одном из узлов, сбрасывая соединение или возвращая ошибку в отет на запрос в момент синхронизации данных (Consistency). Такое поведение системы, вероятно, будет наблюдаться и в момент потери сетевой связности между узлами - система не будет отвечать на запросы, пока не восстановится связность между узлами и данные не будут синхронизированы. В ситуации, когда разделения по сети между узлами нет, данная система, скорее всего, также будет стремиться к поддержанию актуальности данных на всех узлах (Consistency). Итого:
  - CAP теорема: **CP система**
  - PACELC теорема: **PC/EC система**

## Задача 3

>Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

**Ответ:**

Как мне кажется, нет, не могут. ACID требует высокой надежности данных, иногда в ущерб доступности системы. А принципы BASE делают ставку на обработку каждого запроса, делая ставку на доступность системы в ущерб согласованности данных. Эти два принципа обработки тразакций не могут сочетаться в рамках одной системы.

## Задача 4

>Вам дали задачу написать системное решение, основой которого бы послужили:
>
>- фиксация некоторых значений с временем жизни
>- реакция на истечение таймаута
>
>Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). Что это за система? Какие минусы выбора данной системы?

**Ответ:**

Данной системой является `Redis`. К минусам данной системы можно отнести:

- Redis хранит всю информацию в оперативной памяти, соответственно требуется большой объем RAM на хосте, где будет развернута система
- При распределенной архитектуре, в случае выключения одного из узлов, часть данных может быть утеряна
- Требует дополнительной конфигурации отказоустойчивости при работе в распределенной архитектуре (Redis Sentinel)
