# Домашнее задание к занятию "7.2. Облачные провайдеры и синтаксис Terraform." - Михаил Караханов

## Задача 1 (Вариант с Yandex.Cloud). Регистрация в ЯО и знакомство с основами (необязательно, но крайне желательно)

>1. Подробная инструкция на русском языке содержится [здесь](https://cloud.yandex.ru/docs/solutions/infrastructure-management/terraform-quickstart).
>2. Обратите внимание на период бесплатного использования после регистрации аккаунта.
>3. Используйте раздел "Подготовьте облако к работе" для регистрации аккаунта. Далее раздел "Настройте провайдер" для подготовки
базового терраформ конфига.
>4. Воспользуйтесь [инструкцией](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs) на сайте терраформа, что бы не указывать авторизационный токен в коде, а терраформ провайдер брал его из переменных окружений.

## Выполнение Задачи 1 (Yandex.Cloud)

Учетная запись в Yandex.Cloud у меня была создана ранее, включая service-account и ключ для него (в формате .json). Для Terraform создал переменную окружения `YC_SERVICE_ACCOUNT_KEY_FILE`, в которую поместил путь до файла ключа.

## Задача 2. Создание aws ec2 или yandex_compute_instance через терраформ

1. В каталоге `terraform` вашего основного репозитория, который был создан в начале курсе, создайте файл `main.tf` и `versions.tf`.
2. Зарегистрируйте провайдер
   1. для [aws](https://registry.terraform.io/providers/hashicorp/aws/latest/docs). В файл `main.tf` добавьте
   блок `provider`, а в `versions.tf` блок `terraform` с вложенным блоком `required_providers`. Укажите любой выбранный вами регион внутри блока `provider`.
   2. либо для [yandex.cloud](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs). Подробную инструкцию можно найти [здесь](https://cloud.yandex.ru/docs/solutions/infrastructure-management/terraform-quickstart).
3. Внимание! В гит репозиторий нельзя пушить ваши личные ключи доступа к аккаунту. Поэтому в предыдущем задании мы указывали
их в виде переменных окружения.
4. В файле `main.tf` воспользуйтесь блоком `data "aws_ami` для поиска ami образа последнего Ubuntu.  
5. В файле `main.tf` создайте рессурс
   1. либо [ec2 instance](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance).
   Постарайтесь указать как можно больше параметров для его определения. Минимальный набор параметров указан в первом блоке `Example Usage`, но желательно, указать большее количество параметров.
   2. либо [yandex_compute_image](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/compute_image).
6. Также в случае использования aws:
   1. Добавьте data-блоки `aws_caller_identity` и `aws_region`.
   2. В файл `outputs.tf` поместить блоки `output` с данными об используемых в данный момент:
       * AWS account ID,
       * AWS user ID,
       * AWS регион, который используется в данный момент,
       * Приватный IP ec2 инстансы,
       * Идентификатор подсети в которой создан инстанс.  
7. Если вы выполнили первый пункт, то добейтесь того, что бы команда `terraform plan` выполнялась без ошибок.

## Выполнение Задачи 2 (Yandex.Cloud)

В каталоге `terraform` создал файлы `main.tf`, `versions.tf`, `variables.tf` и `outputs.tf`.

В файлах `main.tf` и `versions.tf` указана информация об используемом провайдере и создаваемых ресурсах. Служебные переменные определены в файле `variables.tf`. Переменные для вывода информации в консоль после применения конфигурации определены в файле `outputs.tf`.

Команда `terraform plan` отрабатывает без ошибок.

После выполнения команды `terraform apply`, ресурсы в облаке создаются, секция outputs отображается как запланировано:

![outputs](/img/07_02_outputs.png)

В качестве результата задания предоставьте:

1. Ответ на вопрос: при помощи какого инструмента (из разобранных на прошлом занятии) можно создать свой образ ami?  
    **Ответ:** для создания образа можно использовать утилиту `packer`
1. Ссылку на репозиторий с исходной конфигурацией терраформа.  
    **Ответ:** ссылку на репозиторий прикрепил в личном кабинете
